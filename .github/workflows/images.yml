name: images
run-name: 'images: ${{ inputs.device }} / fedora ${{ inputs.fedora_branch }}'
on:
  workflow_dispatch:
    inputs:
      device:
        type: choice
        description: 'device name'
        required: true
        options:
          - nothing-spacewar
          - oneplus-sdm845
          - xiaomi-nabu
          - xiaomi-pipa
          - xunlong-orangepi3
      fedora_branch:
        type: choice
        description: fedora branch
        required: true
        options:
          - '42'
          - '42-orangepi3'
          - '43'
          - 'rawhide'
        default: '42'
jobs:
  images:
    runs-on: ubuntu-24.04-arm
    strategy:
      fail-fast: false
      matrix:
        desktop: [gnome-desktop, gnome-mobile, plasma-desktop, plasma-mobile, phosh]
    name: ${{ inputs.device }}-${{ matrix.desktop }}:${{ inputs.fedora_branch }}
    steps:
      - uses: actions/checkout@v4
      - uses: pocketblue/actions/images@whole-image
        with:
          device: ${{ inputs.device }}
          registry: ${{ vars.REGISTRY }}
          image_name: ${{ inputs.device }}-${{ matrix.desktop }}
          image_tag: ${{ inputs.fedora_branch }}
      - uses: actions/upload-artifact@v4
        with:
          name: pocketblue-${{ inputs.device }}-${{ matrix.desktop }}-${{ inputs.fedora_branch }}
          path: pocketblue-${{ inputs.device }}-${{ matrix.desktop }}-${{ inputs.fedora_branch }}.7z
          compression-level: 0
